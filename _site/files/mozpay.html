<html>
  <title>Android mozPay Cookie Test (Start)</title>
  <body>
  <h1>Android mozPay Cookie Test (Start)</h1>
  <a id="start" href="#">Test</a>
  <pre id="jwt">{
  "iss": "323d34dc-b5cf-4822-8e47-6a4515dc74db",
  "aud": "marketplace.firefox.com",
  "typ": "mozilla-local/payments/pay/v1",
  "iat": 1386026840,
  "exp": 1386030440,
  "request": {
    "pricePoint": 10,
    "id": "4b33b9fb-9745-4e2e-9a19-e58007245060",
    "name": "Virtual Kiwi",
    "description": "The forbidden fruit",
    "icons": {
      "32": "https://inapp-pay-test.paas.allizom.org/img/kiwi_32.png",
      "48": "https://inapp-pay-test.paas.allizom.org/img/kiwi_48.png",
      "64": "https://inapp-pay-test.paas.allizom.org/img/kiwi_64.png",
      "128": "https://inapp-pay-test.paas.allizom.org/img/kiwi_128.png"
    },
    "productData": "<this is not editable>",
    "chargebackURL": "<this is not editable>",
    "postbackURL": "<this is not editable>",
    "defaultLocale": "en",
    "locales": {
      "pl": {
        "name": "Wirtualna Kiwi",
        "description": "Zakazany owoc"
      }
    }
  }
}</pre>
  <pre id="output"></pre>
  <script src="https://raw.github.com/michaelrhanson/jwt-js/master/lib/sjcl/sjcl.js"></script>
  <script src="https://raw.github.com/michaelrhanson/jwt-js/master/src/jwt-token.js"></script>
  <script type="text/javascript">
var hs256 = "{\"typ\":\"JWT\",\r\n"+
                 " \"alg\":\"HS256\"}";
  var now = new Date();
  document.cookie = "test1=mozpay-worked-time:" + now.getTime();
  var aKeys = document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g, "").split(/\s*(?:\=[^;]*)?;\s*/);
  var target = document.getElementById('output');
  for (var nIdx = 0; nIdx < aKeys.length; nIdx++) { 
    output.innerHTML = output.innerHTML + nIdx + '. ' + decodeURIComponent(aKeys[nIdx]) + ': ' + decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*" + encodeURIComponent(aKeys[nIdx]).replace(/[\-\.\+\*]/g, "\\$&") + "\\s*\\=\\s*([^;]*).*$)|^.*$"), "$1")) + '\n';
  }
  var start = document.getElementById('start');
  function startPay() {
    var token = new jwt.WebToken(document.getElementById('jwt').textContent, hs256);
    console.log(token.serialize('foo'));
    navigator.mozPay(token.serialize('foo'));
    return false; 
  }
  
  start.addEventListener('click', startPay, false);
  </script>
  </body>
</html>
