<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">
    <title>Mock Payment Provider</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
  </head>
  <body>
    <script>
      // Mock public payment provider JWT
      const mockJWT = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiIxMjM0NTY3ODkiLCJhdWQiOiJNb2NrIFBheW1lbnQgUHJvdmlkZXIiLCJ0eXAiOiJtb2NrXC9wYXltZW50c1wvaW5hcHBcL3YxIiwiZXhwIjoxMzQ1MjU5ODgyLCJpYXQiOjEzNDUyNTYyODIsInJlcXVlc3QiOnsibmFtZSI6IlBpZWNlIG9mIENha2UiLCJkZXNjcmlwdGlvbiI6IlZpcnR1YWwgY2hvY29sYXRlIGNha2UgdG8gZmlsbCB5b3VyIHZpcnR1YWwgdHVtbXkiLCJwcmljZSI6W3siY291bnRyeSI6IlVTIiwiYW1vdW50IjoiNS41MCIsImN1cnJlbmN5IjoiVVNEIn0seyJjb3VudHJ5IjoiQlIiLCJhbW91bnQiOiI4LjUwIiwiY3VycmVuY3kiOiJCUkwifV19fQ.EaXnlL7LUlmYXUTty5ZkUQ7VZeCBa_edi2YXKPnjSl4";

      function pay(JWTs) {
        if (!JWTs) {
          JWTs = [document.getElementById('jwt').value];
          console.log(JWTs);
        }
        var request = navigator.mozPay(JWTs);
        request.onsuccess = function onsuccess() {
          console.log("onsuccess received");
          document.getElementById("result").innerHTML = "Payment success";
        };
        request.onerror = function onerror() {
          console.log("onerror received");
          document.getElementById("result").innerHTML = "Payment error " + request.error.name;
        };
      }
    </script>
    <style>
      .starter-template {
        padding: 40px 15px;
      }
      .bs-callout-info h3 {
        margin-top: 0;
        color: #1B809E;
        font-size: 18px;
      }
      .bs-callout.bs-callout-info {
        border-left-color: #1B809E;
      }
      .bs-callout {
          padding: 20px;
          margin: 20px 0px;
          border-width: 1px 1px 1px 5px;
          border-style: solid;
          border-color: #EEE;
          -moz-border-top-colors: none;
          -moz-border-right-colors: none;
          -moz-border-bottom-colors: none;
          -moz-border-left-colors: none;
          border-image: none;
          border-radius: 3px;
      }
    </style>

    <div class="container">

      <div class="starter-template">
        <h1>Testing code in the Trusted UI</h1>
        <p class="lead">The trusted UI is a specialized interface on FFOS devices to handle payments. It has some limited features by design.</p>
        <p>The content here is to help setup an environent that will allow you to run the trusted UI as a mock payment provider</p>
        <p id="result"></p>
        <button type="button" class="btn btn-default" onclick="pay([mockJWT])">Open Mock Payment Provider</button>

        <h2>Setup the Mock provider on your device</h2>

        <p>Using adb run the following: <code>adb pull data/local/user.js</code></p>

        <p>If the file doesn't exist don't worry we can create it now</p>
        <p>Copy the following settings (and save as 'user.js'):</p>

        <div class="bs-callout bs-callout-info">
          <h3>Customizing the URL</h3>
          <p>If you want to customize the location of the mock payment provider change the setting
          <code>dom.payment.provider.uri</code> to something else. However, be sure to leave a <code>?req=</code> on the end of your link.</p>
        </div>


        <pre><code>pref("dom.payment.provider.4.name", "mock");
pref("dom.payment.provider.4.description", "mock");
pref("dom.payment.provider.4.uri", "http://www.agmweb.ca/files/boku/?req=");
pref("dom.payment.provider.4.type", "mock/payments/inapp/v1");
pref("dom.payment.provider.4.requestMethod", "GET");</code></pre>
        <p>Push them onto your device with: <code>adb push user.js data/local/user.js</code></p>
        <p>Then run: <code>adb shell 'stop b2g && start b2g'</code></p>

         <h2>Using the settings on a simulator</h2>
         <p>You can also use these settings on a simulator. First you need to <a href="https://support.mozilla.org/en-US/kb/profiles-where-firefox-stores-user-data">find your Firefox profile</a>. From there look inside the extensions directory e.g: <code>fxos_2_2_simulator@mozilla.org</code></p>
         <p>Once you've chosen the simulator profile to update save the user.js in the profile directory. When you're done the full path will look similar to the following: <code>PATH_TO_PROFILE/fxos_VERSION_simulator@mozilla.org/profile/user.js</code></p>

        <h2>Open the mock provider</h2>
        <p>Once setup click this button to open the mock payment provider in the trusted ui</p>
        <button type="button" class="btn btn-default" onclick="pay([mockJWT])">Open Mock Payment Provider</button>
      </div>

    </div><!-- /.container -->
     </body>
</html>
